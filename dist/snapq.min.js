//snapQ 1.0.9 https://github.com/chsneo/underscore.snapQ
(function(){_.mixin({nextItem:function(a,b){var c=_.indexOf(a,b);return c<a.length-1?a[c+1]:_.first(a)},previousItem:function(a,b){var c=_.indexOf(a,b);return 0<c?a[c-1]:_.last(a)},keyIndex:function(a,b,c){b=_.findWhere(a,{key:c});a=_.indexOf(a,b);return-1===a?null:a},pluckMultiple:function(){var a=_.rest(arguments,1);return _.map(arguments[0],function(b){var c={};_.each(a,function(a){c[a]=b[a]});return c})},pushMultiple:function(a,b){_.each(b,function(b){a.push(b)})},rejectMultiple:function(a,b,c){return _.reject(a,function(a){return-1!=b.indexOf(a[c])})},findMultiple:function(a,b,c){return _.filter(a,function(a){return-1!=b.indexOf(a[c])})},toCommaString:function(a,b,c){c=c||",";return _.pluck(a,b||"id").join(c)},addToggle:function(a,b,c){a=a||[];var d;if(c){if(d=_.find(a,function(a){return a[c]===b[c]}))return _.filter(a,function(a){return a[c]!==b[c]})}else if(d=_.indexOf(a,function(a){return a===b}),-1<d)return _.filter(a,function(a){return a!==b});a.push(b);return a},deleteItem:function(a,b){var c=a.indexOf(b);-1!=c&&a.splice(c,1)},match:function(a,b){_.isArray(a)&&_.isArray(b)&&_.each(a,function(a){a.$$match=!!_.findWhere(b,{id:a.id})})},getTime:function(a){var b="00",c="00",d="00",e,h,k,l,f,g;try{e=a.split(" ");f=_.last(e);"AM"===f||"am"===f?h=_.previousItem(e,f):"PM"===f||"pm"===f?(h=_.previousItem(e,f),k=!0):(h=f,g=!0);l=h.split(":");b=parseInt(l[0]);if(!g&&!k&&12===b)b=0;else if(g||k)!g&&k&&12===b?b=12:g||(b+=12);c=parseInt(l[1]);d=parseInt(l[2])}catch(m){console.error("! unable to parse "+a)}return{hh:b,mm:c,ss:d}},previousMonth:function(a){a=new Date(a);a.setMonth(a.getMonth()-1);return a},nextMonth:function(a){a=new Date(a);a.setMonth(a.getMonth()+1);return a},elapsedTime:function(a,b){var c=new Date(a),c=(new Date(b)).getTime()-c.getTime();return{milliseconds:c,seconds:c/1E3}},toJSONDateTime:function(a){return(new Date(a)).toJSON()},toJSONLocalDateTime:function(a){a=new Date(a);return(new Date(a.addMinutes(-a.getTimezoneOffset()))).toJSON()},toJSONLocalDate:function(a){return _.toJSONLocalDateTime(a).split("T")[0]},getMonday:function(a){a=new Date(a);var b=a.getDay(),b=a.getDate()-b+(0==b?-6:1);return(new Date(a.setDate(b))).setHours(0,0,0,0)},getLastSundayOf:function(a){var b=new Date(a,11,31);return 6==b.getDay()?_.resetTime(b):_.resetTime(new Date(a,11,31-b.getDay()))},getDayForWeeks:function(a,b,c){if(!(6<c)){a=new Date(a);a.getMonth();b=new Date(b);var d=[];a.setHours(0,0,0,0);b.setHours(0,0,0,0);for(a.setDate(c);a.getDay()!==c;)a.setDate(a.getDate()+1);for(;a<=b;)d.push(new Date(a.getTime())),a.setDate(a.getDate()+7);return d}},resetTime:function(a){a=new Date(a);a.setHours(0,0,0,0);return a},addDays:function(a,b){var c=new Date(a);c.addDays(b);return c},compareMonth:function(a,b){return a.getMonth()==b.getMonth()&&a.getFullYear()==b.getFullYear()},compareYear:function(a,b){return a.getFullYear()==b.getFullYear()},tomorrow:function(){return(new Date).setDate(1)},yesterday:function(){return(new Date).setDate(-1)},uid:function(){return(new Date).getTime()},retry:function(a,b,c){var d=slice.call(arguments,3);b()?a.apply(this,d):_.delay.apply(this,[_.retry,c,a,b,c].concat(d))},leadingZero:function(a){a=Number(a)|0;return 10<=a?a:"0"+a},capitalize:function(a){return a.replace(/(?:^|\s)\S/g,function(a){return a.toUpperCase()})},getFileName:function(a,b){var c=a.substr(a.lastIndexOf("/")+1);b&&c&&(c=c.split("?")[0]);c||alert("ERROR URL");return c},startsWith:function(a,b){return a&&b?0==a.indexOf(b):!1},removeAfter:function(a,b){if(!a)return"";if(!b)return a;var c="";return(c=a.split(b)[0])||a},compactObject:function(a,b){var c=_.clone(a);_.each(c,function(a,e){_.isUndefined(a)?delete c[e]:b&&e==b&&delete c[e]});return c},hasDeep:function(a,b){return a||b?_.reduce(b.split("."),function(a,b){a.object.hasOwnProperty(b)?a.object=a.object[b]:a.result=!1;return a},{object:a,result:!0}).result:!1},valueOrDefault:function(a,b,c){if(!a&&!b)return c;a=_.reduce(b.split("."),function(a,b){a.object.hasOwnProperty(b)?a.object=a.object[b]:a.result=!1;return a},{object:a,result:!0});return a.result?a.object:c}})})();